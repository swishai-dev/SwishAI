# Implementation Plan: Basketball Data Fetching Layer (Polymarket Gamma API)

**Branch**: `003-basketball-data-layer` | **Date**: 2026-01-17 | **Spec**: [/specs/003-basketball-data-layer/spec.md](spec.md)
**Input**: Feature specification from `/specs/003-basketball-data-layer/spec.md`

## Summary

The project will implement a dedicated data-fetching layer to retrieve active and upcoming basketball markets (NBA, NCAA, EuroLeague) from the Polymarket Gamma API. The architecture will feature a centralized `PolymarketService` for API communication, a `GameService` for matchup normalization, and a `PropService` for extracting core betting markets (Moneyline, Spread, Totals). A Redis-based caching layer with short TTL will ensure performance and simulate "fresh" analysis during repeated requests. Data will be persisted in PostgreSQL via Prisma for reliability and served through clean REST endpoints.

## Technical Context

**Language/Version**: TypeScript / Node.js 20+ (Next.js 14/15 App Router)
**Primary Dependencies**: Next.js, Redis (ioredis), Prisma, Tailwind CSS, Framer Motion, GSAP, Three.js.
**Storage**: PostgreSQL (Primary), Redis (Cache)
**Testing**: Vitest (Unit/Integration)
**Target Platform**: Web (Vercel / Docker)
**Project Type**: Next.js fullstack application
**Performance Goals**: API response < 200ms (cached), Data sync < 1s.
**Constraints**: No player props, no futures, active/open markets only.
**Scale/Scope**: Support for 100+ active basketball matchups with real-time updates.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Code Quality**: ✓ Layered architecture ensures single responsibility; normalization logic separated from API fetching.
**Testing Standards**: ✓ Comprehensive unit tests for filtering and normalization logic; integration tests for Redis/Prisma.
**User Experience Consistency**: ✓ Real-time data updates with smooth UI transitions; consistent dashboard layout.
**Performance Requirements**: ✓ Redis caching and optimized Prisma queries meet sub-200ms goal.
**Technology Stack**: ✓ Next.js App Router; Redis for high-speed caching; Prisma for type-safe DB access.
**File Structure**: ✓ Domain-driven organization (`lib/data`, `lib/services`, `app/api`).
**Responsive Design**: ✓ Clean JSON output supports mobile-first frontend implementation.

## Project Structure

### Documentation (this feature)

```text
specs/003-basketball-data-layer/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
app/
└── api/
    └── v1/
        ├── games/       # List games, filtered by league
        └── props/       # Fetch props for specific game ID

lib/
├── services/
│   ├── polymarket.ts    # Gamma API client & raw filtering
│   ├── game.ts          # Matchup extraction & normalization
│   ├── prop.ts          # Head prop extraction logic
│   └── cache.ts         # Redis integration with TTL & simulation delay
├── db.ts                # Prisma client singleton
└── redis.ts             # Redis client singleton

prisma/
└── schema.prisma        # Game, Prop, and Snapshot models

types/
├── polymarket.ts        # Raw Gamma API interfaces
└── domain.ts            # Normalized Game and Prop interfaces
```

**Structure Decision**: Next.js fullstack application. All business logic for data fetching and normalization is encapsulated in `lib/services` to ensure testability and clean API routes.

## Complexity Tracking

*No violations of the Constitution identified.*
